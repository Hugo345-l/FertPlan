-- Correção dos erros relacionados ao tamanho da coluna "INTERNACIONAL" 
-- O erro indica que o valor inserido ('SIM', 'NÃO') não cabe na definição atual da coluna CHAR(3), pois "NÃO" possui 4 caracteres.
-- Ajustaremos a definição da coluna para permitir até 4 caracteres.

DROP TABLE FP_CULTURA_SOLO_FERTILIZANTE CASCADE CONSTRAINTS;
DROP TABLE FP_CICLO_FASE CASCADE CONSTRAINTS;
DROP TABLE FP_FASE_CRESCIMENTO CASCADE CONSTRAINTS;
DROP TABLE FP_CULTURA CASCADE CONSTRAINTS;
DROP TABLE FP_FERTILIZANTE CASCADE CONSTRAINTS;
DROP TABLE FP_SOLO CASCADE CONSTRAINTS;
DROP TABLE FP_PROPRIEDADE CASCADE CONSTRAINTS;
DROP TABLE FP_AGRICULTOR CASCADE CONSTRAINTS;

CREATE TABLE FP_AGRICULTOR (
    agricultor_id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    nome VARCHAR2(50) NOT NULL,
    email VARCHAR2(100),
    telefone VARCHAR2(15),
    data_cadastro DATE DEFAULT SYSDATE
);

CREATE TABLE FP_PROPRIEDADE (
    propriedade_id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    agricultor_id NUMBER NOT NULL,
    nome VARCHAR2(50) NOT NULL,
    localizacao VARCHAR2(100),
    area_total NUMBER(10, 2),
    CONSTRAINT fk_agricultor
        FOREIGN KEY (agricultor_id)
        REFERENCES FP_AGRICULTOR(agricultor_id)
        ON DELETE CASCADE
);

-- Índice para melhorar a performance das consultas pela chave estrangeira
CREATE INDEX idx_propriedade_agricultor ON FP_PROPRIEDADE (agricultor_id);

CREATE TABLE FP_SOLO (
    solo_id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    tipo_solo VARCHAR2(50) NOT NULL
);

CREATE TABLE FP_FERTILIZANTE (
    tipo VARCHAR2(50) NOT NULL,
    fertilizante_id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    nome VARCHAR2(50) NOT NULL,
    concentracao VARCHAR2(50),
    fornecedor VARCHAR2(100) NOT NULL,
    preco_kg_local NUMBER(10, 2),
    preco_kg_importado NUMBER(10, 2),
    internacional CHAR(4) CHECK (internacional IN ('SIM', 'NÃO')) NOT NULL
);

CREATE TABLE FP_CULTURA (
    cultura_id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    nome VARCHAR2(50) NOT NULL
);

CREATE TABLE FP_FASE_CRESCIMENTO (
    fase_id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    descricao VARCHAR2(50) NOT NULL
);

CREATE TABLE FP_CICLO_FASE (
    ciclo_fase_id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    cultura_id NUMBER NOT NULL,
    solo_id NUMBER NOT NULL,
    fase_id NUMBER NOT NULL,
    dias_para_fase NUMBER NOT NULL,
    CONSTRAINT fk_cultura_cultura_solo_fertilizante FOREIGN KEY (cultura_id)
        REFERENCES FP_CULTURA(cultura_id),
    CONSTRAINT fk_solo_cultura_solo_fertilizante FOREIGN KEY (solo_id)
        REFERENCES FP_SOLO(solo_id),
    CONSTRAINT fk_fase
        FOREIGN KEY (fase_id)
        REFERENCES FP_FASE_CRESCIMENTO(fase_id),
    CONSTRAINT unq_cultura_solo_fase UNIQUE (cultura_id, solo_id, fase_id)
);

-- Índice para melhorar a performance das consultas pelas chaves estrangeiras
CREATE INDEX idx_cultura_solo ON FP_CICLO_FASE (cultura_id, solo_id);

-- Populando a tabela FP_SOLO
INSERT INTO FP_SOLO (tipo_solo) VALUES ('Argiloso');
INSERT INTO FP_SOLO (tipo_solo) VALUES ('Textura Média');
INSERT INTO FP_SOLO (tipo_solo) VALUES ('Latossolo');
INSERT INTO FP_SOLO (tipo_solo) VALUES ('Latossolo Vermelho');
INSERT INTO FP_SOLO (tipo_solo) VALUES ('Argissolo');
INSERT INTO FP_SOLO (tipo_solo) VALUES ('Massapê');
INSERT INTO FP_SOLO (tipo_solo) VALUES ('Gleissolo');

-- Populando a tabela FP_FERTILIZANTE
INSERT INTO FP_FERTILIZANTE (tipo, nome, concentracao, fornecedor, preco_kg_local, preco_kg_importado, internacional) VALUES ('Nitrogenado', 'Ureia', 'NPK 46-0-0', 'Fornecedor A', 1.50, 2.00, 'NÃO');
INSERT INTO FP_FERTILIZANTE (tipo, nome, concentracao, fornecedor, preco_kg_local, preco_kg_importado, internacional) VALUES ('Fosfatado', 'Fosfato Natural', 'NPK 0-20-0', 'Fornecedor B', 2.00, 3.00, 'NÃO');
INSERT INTO FP_FERTILIZANTE (tipo, nome, concentracao, fornecedor, preco_kg_local, preco_kg_importado, internacional) VALUES ('Fosfatado', 'Superfosfato Triplo', 'NPK 0-45-0', 'Fornecedor C', 2.50, 3.50, 'SIM');
INSERT INTO FP_FERTILIZANTE (tipo, nome, concentracao, fornecedor, preco_kg_local, preco_kg_importado, internacional) VALUES ('Orgânico', 'Adubo Orgânico', 'Orgânico', 'Fornecedor D', 1.20, 1.80, 'NÃO');
INSERT INTO FP_FERTILIZANTE (tipo, nome, concentracao, fornecedor, preco_kg_local, preco_kg_importado, internacional) VALUES ('Micronutriente', 'Micronutrientes com Zinco e Boro', 'Micronutrientes', 'Fornecedor E', 3.00, 4.00, 'SIM');
INSERT INTO FP_FERTILIZANTE (tipo, nome, concentracao, fornecedor, preco_kg_local, preco_kg_importado, internacional) VALUES ('Balanceado', 'NPK Balanceado', 'NPK 20-10-10', 'Fornecedor F', 1.80, 2.50, 'NÃO');
INSERT INTO FP_FERTILIZANTE (tipo, nome, concentracao, fornecedor, preco_kg_local, preco_kg_importado, internacional) VALUES ('Fosfatado', 'Fosfato Diamônio', 'NPK 18-46-0', 'Fornecedor G', 2.80, 3.80, 'SIM');
INSERT INTO FP_FERTILIZANTE (tipo, nome, concentracao, fornecedor, preco_kg_local, preco_kg_importado, internacional) VALUES ('Potássico', 'Cloreto de Potássio', 'KCl 60%', 'Fornecedor H', 2.50, 3.20, 'SIM');
INSERT INTO FP_FERTILIZANTE (tipo, nome, concentracao, fornecedor, preco_kg_local, preco_kg_importado, internacional) VALUES ('Nitrogenado', 'Sulfato de Amônio', 'NPK 21-0-0', 'Fornecedor I', 1.90, 2.30, 'NÃO');
INSERT INTO FP_FERTILIZANTE (tipo, nome, concentracao, fornecedor, preco_kg_local, preco_kg_importado, internacional) VALUES ('Micronutriente', 'Sulfo-Magnesiano', 'MgS 22%', 'Fornecedor J', 2.20, 2.90, 'SIM');
INSERT INTO FP_FERTILIZANTE (tipo, nome, concentracao, fornecedor, preco_kg_local, preco_kg_importado, internacional) VALUES ('Nitrogenado', 'Nitrogênio Líquido', 'NPK 34-0-0', 'Fornecedor K', 2.00, 3.00, 'SIM');
INSERT INTO FP_FERTILIZANTE (tipo, nome, concentracao, fornecedor, preco_kg_local, preco_kg_importado, internacional) VALUES ('Fosfatado', 'Superfosfato Simples', 'NPK 0-20-0', 'Fornecedor L', 1.70, 2.50, 'NÃO');

-- Populando a tabela FP_CULTURA
INSERT INTO FP_CULTURA (nome) VALUES ('Milho');
INSERT INTO FP_CULTURA (nome) VALUES ('Soja');
INSERT INTO FP_CULTURA (nome) VALUES ('Cana-de-Açúcar');

-- Populando a tabela FP_FASE_CRESCIMENTO
INSERT INTO FP_FASE_CRESCIMENTO (descricao) VALUES ('Crescimento Inicial');
INSERT INTO FP_FASE_CRESCIMENTO (descricao) VALUES ('Pré-Plantio');
INSERT INTO FP_FASE_CRESCIMENTO (descricao) VALUES ('Floração');
INSERT INTO FP_FASE_CRESCIMENTO (descricao) VALUES ('Vegetativo');
INSERT INTO FP_FASE_CRESCIMENTO (descricao) VALUES ('Estabelecimento');
INSERT INTO FP_FASE_CRESCIMENTO (descricao) VALUES ('Crescimento Vegetativo');

-- Populando a tabela FP_CICLO_FASE
INSERT INTO FP_CICLO_FASE (cultura_id, solo_id, fase_id, dias_para_fase) VALUES (1, 1, 1, 30);
INSERT INTO FP_CICLO_FASE (cultura_id, solo_id, fase_id, dias_para_fase) VALUES (1, 1, 2, 20);
INSERT INTO FP_CICLO_FASE (cultura_id, solo_id, fase_id, dias_para_fase) VALUES (1, 1, 3, 40);
INSERT INTO FP_CICLO_FASE (cultura_id, solo_id, fase_id, dias_para_fase) VALUES (1, 3, 1, 35);
INSERT INTO FP_CICLO_FASE (cultura_id, solo_id, fase_id, dias_para_fase) VALUES (1, 3, 2, 25);
INSERT INTO FP_CICLO_FASE (cultura_id, solo_id, fase_id, dias_para_fase) VALUES (1, 3, 3, 50);
INSERT INTO FP_CICLO_FASE (cultura_id, solo_id, fase_id, dias_para_fase) VALUES (2, 4, 1, 25);
INSERT INTO FP_CICLO_FASE (cultura_id, solo_id, fase_id, dias_para_fase) VALUES (2, 4, 2, 30);
INSERT INTO FP_CICLO_FASE (cultura_id, solo_id, fase_id, dias_para_fase) VALUES (2, 4, 3, 45);
INSERT INTO FP_CICLO_FASE (cultura_id, solo_id, fase_id, dias_para_fase) VALUES (2, 5, 1, 20);
INSERT INTO FP_CICLO_FASE (cultura_id, solo_id, fase_id, dias_para_fase) VALUES (2, 5, 2, 40);
INSERT INTO FP_CICLO_FASE (cultura_id, solo_id, fase_id, dias_para_fase) VALUES (2, 5, 3, 50);
INSERT INTO FP_CICLO_FASE (cultura_id, solo_id, fase_id, dias_para_fase) VALUES (3, 6, 1, 40);
INSERT INTO FP_CICLO_FASE (cultura_id, solo_id, fase_id, dias_para_fase) VALUES (3, 6, 2, 30);
INSERT INTO FP_CICLO_FASE (cultura_id, solo_id, fase_id, dias_para_fase) VALUES (3, 6, 3, 60);
INSERT INTO FP_CICLO_FASE (cultura_id, solo_id, fase_id, dias_para_fase) VALUES (3, 7, 1, 45);